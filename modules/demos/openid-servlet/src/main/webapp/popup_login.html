<html>
<head>
<title>OpenID Login without refreshing or leaving the page</title>
<style type="text/css">
#container {
 padding: 1em;
 font-family: Tahoma,Verdana;
}
.info {
 color: #fff;
 padding: 0 5px;
 background-color: green;
}
.info p {
 font-size: 1.6em;
}
.green {
 color: green;
}
.red {
 color: red;
}
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript">
//<!--
function getCenteredCoords(width, height) {
    var xPos = null;
    var yPos = null;
    if (window.ActiveXObject) {
        xPos = window.event.screenX - (width/2) + 100;
        yPos = window.event.screenY - (height/2) - 100;
    } else {
        var parentSize = [window.outerWidth, window.outerHeight];
        var parentPos = [window.screenX, window.screenY];
        xPos = parentPos[0] +
            Math.max(0, Math.floor((parentSize[0] - width) / 2));
        yPos = parentPos[1] +
            Math.max(0, Math.floor((parentSize[1] - (height*1.25)) / 2));
    }
   return [xPos, yPos];
}

function handleOpenIDResponse(openid_args) {
  $("#msg").hide().html("<p>Verifying authentication ...</p>").show();
  $.ajax({
    type: "POST",
    url: "/popup_verify/",
    data: openid_args,
    dataType: "json",
    success: function(user){
     $("#login").hide();
     $("#logout").show();
     $("#msg").hide().html("<p><span class='green'>" + user.b + "</span> is authenticated.</p>").show(1500);
    },
    error: function(xhr, errStatus, errMessage) {
      $("#msg").html("<p class='red'>Login failed.  Please try again.</p>");
    }
  });
}

$(function(){
  $("#logout").hide();
  $("#login").hide();
  $("#login").click(function(e){
    var w = window.open("/filtered.jsp?popup=true", "openid_popup", "width=450,height=500,location=1,status=1,resizable=yes");
    var coords = getCenteredCoords(450,500);
    w.moveTo(coords[0],coords[1]);
  });
  $("#logout").click(function(e){
    $.ajax({
      type: "GET",
      url: "/popup_verify/?logout=true",
      success: function(text){
        $("#logout").hide();
        $("#login").show();
        $("#msg").hide().html("<p>You are currently not logged in.</p>").show(1500);
      }
    });
  });
  $.ajax({
    type: "GET",
    url: "/popup_verify/",
    dataType: "json",
    success: function(user){
     $("#login").hide();
     $("#logout").show();
     $("#msg").hide().html("<p><span class='green'>" + user.b + "</span> is authenticated.</p>").show(1500);
    },
    error: function(xhr, errStatus, errMessage) {
      $("#logout").hide();
      $("#login").show();
      $("#msg").html("<p>You are currently not logged in.</p>");
    }
  });
  
});
//-->
</script>

</head>
<body>
<div id="container">
  <div class="info">
    <p>OpenID Login without refreshing or leaving the page</p>
  </div>
  <div>
    <button id="login">Login</button>
    <button id="logout">Logout</button>
    <div id="msg"></div>
  </div>
</div>
</body>
</html>
